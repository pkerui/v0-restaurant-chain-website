# 高德地图集成说明

## 功能特点

✅ **已完成集成**：
- 在门店页面显示高德地图
- 自动标记所有门店位置
- 点击标记显示门店详细信息
- 自动调整地图视野以显示所有门店
- 支持缩放、拖动等地图操作
- 提供导航按钮直达高德地图导航

## 配置步骤

### 1. 注册高德开放平台账号

访问：https://lbs.amap.com/

### 2. 创建应用并获取 Key

1. 登录后进入"控制台"
2. 点击"应用管理" → "我的应用" → "创建新应用"
3. 填写应用名称：`潮来餐饮网站`
4. 点击"添加" → 选择 **"Web端(JS API)"**
5. 填写信息：
   - 服务平台：`Web端(JS API)`
   - Key名称：`潮来网站地图`
   - 安全密钥：保存生成的密钥
   - 域名白名单：`localhost,你的域名.com`

### 3. 获取安全密钥（可选但推荐）

1. 在应用详情页面找到"安全密钥"
2. 如果没有，点击"申请安全密钥"
3. 保存生成的安全密钥（securityJsCode）

### 4. 配置到项目中

打开文件：`lib/amap/config.ts`

替换以下配置：

```typescript
export const AMAP_CONFIG = {
  // Web端 JavaScript API Key
  key: '「替换为您的Key」',

  // 安全密钥（securityJsCode）
  securityJsCode: '「替换为您的安全密钥」',

  // API 版本
  version: '2.0',

  // Web服务API Key（用于地理编码等服务端接口）
  // 可以与 JavaScript API Key 相同，也可以单独申请
  webServiceKey: '「替换为您的Key」',
}
```

**注意**：
- `key` 和 `webServiceKey` 可以使用同一个 Key
- 如果需要更高的调用配额，建议分别申请 Web端(JS API) 和 Web服务 两个 Key

### 5. 在管理后台添加门店坐标

✅ **已集成自动获取坐标功能！**

现在在门店管理中，您可以：

1. **访问门店管理后台**：`/admin/stores`

2. **添加或编辑门店**：
   - 输入门店的详细地址（例如：汕头市金平区XX路XX号）
   - 点击"自动获取坐标"按钮
   - 系统会自动调用高德地图API获取经纬度

3. **查看坐标状态**：
   - 门店卡片上会显示"已设置地图坐标"或"未设置地图坐标"
   - 表单中会显示获取到的经纬度数值

4. **保存门店**：
   - 坐标会自动保存到数据库
   - 前端地图会立即显示该门店位置

**替代方案**：如果自动获取失败，您也可以手动查询坐标：
1. 访问：https://lbs.amap.com/tools/picker
2. 搜索门店地址，获取经纬度
3. 直接在数据库中更新（不推荐）

## 地图功能说明

### 自动适配视野

地图会自动调整缩放级别和中心点，确保所有门店都在可视范围内。

### 点击标记

点击任何门店标记会显示：
- 门店名称
- 详细地址
- 联系电话（可点击拨打）
- "导航到这里"按钮

### 地图控件

- **缩放按钮**：右下角的 + / - 按钮
- **工具栏**：右上角的地图工具
- **比例尺**：左下角显示地图比例

## 后续优化建议

1. **路线规划**：添加从当前位置到门店的路线规划
2. **周边搜索**：显示门店附近的公交站、地铁站
3. **实时导航**：集成高德导航SDK
4. **自定义图标**：使用餐厅专属的标记图标

## 注意事项

⚠️ **重要**：
- 高德地图 Key 有每日调用次数限制（免费版通常是几万次/天）
- 不要将 Key 提交到公开的代码仓库
- 建议使用环境变量来存储 Key
- 域名白名单要包含您的生产环境域名

## 测试

配置完成后：
1. 访问 `/stores` 页面
2. 滚动到底部的"门店位置地图"
3. 查看是否正确显示地图和标记
4. 点击标记测试信息窗体
5. 测试缩放和拖动功能

## 故障排查

### 地图不显示

- 检查浏览器控制台是否有错误
- 确认 Key 和安全密钥配置正确
- 检查域名是否在白名单中

### 标记不显示

- 确认门店数据中包含 latitude 和 longitude 字段
- 检查坐标格式是否正确（经度在前，纬度在后）
- 汕头市的大致坐标范围：经度 116-117，纬度 23-24

## 需要帮助？

如果您需要：
- 恢复经纬度管理功能
- 添加地址自动解析
- 其他地图功能定制

请告诉我！
